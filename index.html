<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>BETA</title>
	<script src="build/p5.js"></script>
	<script src="build/p5.dom.js"></script>
	<script src="build/p5.sound.js"></script>



	<style>
		body {
			margin:0;
			padding:0;
			overflow: hidden;

		}
		canvas {
	width: 10%; height: 100%

		}

		#info {
			font-family: "SelfModern-Regular";
			font-size: 15px;
			font-weight: normal;
			font-variant: normal;
			font-style : normal;
			text-transform: uppercase;
			color: #000000;
			top:0px;
			margin-top: 5px;
			margin-left: 5px;
          }

					#menu {
						height: 100%;
						width: 60px;
						background : #ffffff;
						font-family: "Times";
						font-size: 12px;
						font-weight: normal;
						font-variant: normal;
						font-style : normal;
						text-transform: uppercase;
						color: #000000;
						top:0px;
						margin-top: 5px;
								}

	</style>
</head>

<body>
	<canvas id="myCanvas"></canvas>
  <link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="font/font.css" />

	<script src="build/three.js"></script>

	<script src="js/PointerLockControls.js"></script>
	<script src="js/OrbitControls.js"></script>
	<script src="js/DeviceOrientationControls.js"></script>

  <script src="js/DDSLoader.js"></script>
	<script src="js/OBJLoader.js"></script>
	<script src="js/MTLLoader.js"></script>

	<script src="js/Reflector.js"></script>

	<link rel="stylesheet" type="text/css" href="css/style.css" />
  <link rel="stylesheet" type="text/css" href="font/font.css" />

  <div id="info" >BETA</div>


<script>

	var renderer,
	controls,
	scene,
	camera,
	myCanvas = document.getElementById('myCanvas');

  var keyboard = {};
	var player = {height:9};


	//RENDERER
  renderer = new THREE.WebGLRenderer({canvas: myCanvas, antialias: true});
  //renderer.setClearColor(0x000000); //background color par défaut
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize( window.innerWidth, window.innerHeight );
	document.body.appendChild( renderer.domElement );

	//CAMERA
	camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 2000 );
	camera.position.set( 15, player.height, 0);
	camera.lookAt(new THREE.Vector3(0,player.height,0));



  //CONTROLS

	controls = new THREE.OrbitControls( camera, renderer.domElement );
	//controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)
	controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
	controls.dampingFactor = 0.25;
	controls.screenSpacePanning = false;
	controls.minDistance = 0;
	//controls.maxDistance = 15;
	controls.maxDistance = 150;
	controls.maxPolarAngle = Math.PI/2.5;



	//SCENE
	scene = new THREE.Scene();



	//LIGHTS
	var light = new THREE.AmbientLight(0xffffff, 0.6);
	scene.add(light);
	var light2 = new THREE.DirectionalLight(0xffffff, 0.5);
	light2.position.set(0,5,-20);
	scene.add(light2);

	var light3 = new THREE.DirectionalLight(0xffffff, 0.7);
	light3.position.set(0,5,18);
	scene.add(light3);

	var light4 = new THREE.DirectionalLight(0x021484, 2);
	light4.position.set(20,5,-20);
	scene.add(light4);


	// IMPORT ÉLÉMENTS 3D
	var mtlLoadertronc2 = new THREE.MTLLoader();

	mtlLoadertronc2.load( "obj/tronc2.mtl", function( materials ) {

	//var modeltex = new THREE.TextureLoader().load( "obj/texture1.jpg" );
	materials.preload();

	var objLoadertronc2 = new THREE.OBJLoader();
	objLoadertronc2.setMaterials(materials);
	objLoadertronc2.load('obj/tronc2.obj',function(tronc2)	{

		  scene.add(tronc2);
		  tronc2.scale.set(9,9,9);
		  tronc2.position.set(-13,6, 5);

	});
});

var mtlLoadersouche = new THREE.MTLLoader();

mtlLoadersouche.load( "obj/souche.mtl", function( materials ) {

materials.preload();

var objLoadersouche = new THREE.OBJLoader();
objLoadersouche.setMaterials(materials);
objLoadersouche.load('obj/souche.obj',function(souche)	{

		scene.add(souche);
		souche.scale.set(4,4,4);
		souche.position.set(0,-3,0);

                                                        });
});

	var mtlLoader = new THREE.MTLLoader();
mtlLoader.setBaseUrl( 'obj/' );
mtlLoader.setPath( 'obj/' );
var url = "/drapé1.mtl";
mtlLoader.load( url, function( materials3 ) {

	materials3.preload();

	var objLoader = new THREE.OBJLoader();
	var objLoader2 = new THREE.OBJLoader();

	objLoader.setMaterials(materials);
	objLoader2.setMaterials(materials);
	objLoader.setPath( 'obj/' );
	objLoader2.setPath( 'obj/' );



	objLoader2.load('/drapé1.obj',function(object2)	{
			scene.add(object2);
			object2.scale.set(0.2,0.09,0.09);
			object2.position.set(0,-4, 0);
			//object2.children[0].material.side = THREE.DoubleSide;
	});

	objLoader.load('/Palm_01.obj',function(object)	{
   scene.add(object);
			object.scale.set(0.7,0.7,0.7);
			object.position.set(0, 0, 0);
			//object.children[0].material.side = THREE.DoubleSide;
	});

});


// PANNEAUX IMAGES

	//VIDEO

var video = document.createElement( 'video' );

video.crossOrigin = 'anonymous';
video.width = 600;
video.height = 440;
video.loop = true;
video.muted = false;
video.src = 'textures/fleur_fenetre.mp4';
video.setAttribute( 'webkit-playsinline', 'webkit-playsinline' );
video.play();



// CHARGEMENT PHOTOS
var img1 = new THREE.TextureLoader().load( "textures/0_21.jpg" );
var img2 = new THREE.TextureLoader().load( "textures/manifeste.jpg" );
var img3 = new THREE.TextureLoader().load( "textures/shade.jpg" );
var img4 = new THREE.TextureLoader().load( "textures/img028.jpg" );
var img5 = new THREE.TextureLoader().load( "textures/ciel.jpg" );
var img6 = new THREE.TextureLoader().load( "textures/0005_6.jpg" );
//texture.minFilter = THREE.NearestFilter;
//texture.format = THREE.RGBFormat;
img2.wrapS = THREE.RepeatWrapping;
img2.wrapT = THREE.RepeatWrapping;
img2.repeat.set( 1, 1);

//TEXTURE MURS GALERIE

var mapbump = new THREE.TextureLoader().load( "textures/manifeste.jpg" );
var mapbump2 = new THREE.TextureLoader().load( "textures/0017_18.jpg" );

var texture = [
new THREE.MeshPhongMaterial({map: img3, side: THREE.DoubleSide}),// RIGHT
new THREE.MeshPhongMaterial({map: img3, side: THREE.DoubleSide}), //LEFT
new THREE.MeshPhongMaterial({
  transparency : 0.1,
	//color: 0xffffff,
	map: img5,
	side: THREE.FrontSide}), //TOP
new THREE.MeshPhongMaterial({map: img3, side: THREE.FrontSide}),//BOTTOM
new THREE.MeshPhongMaterial({map: img3, side: THREE.DoubleSide}),//BACK
new THREE.MeshPhongMaterial({map: img4, side: THREE.BackSide}),//FRONT
//new THREE.MeshBasicMaterial({map: img2, side: THREE.DoubleSide})//BACK

];

var materialPhotos = new THREE.MeshFaceMaterial(texture);
var material2 = new THREE.MeshPhongMaterial({map: new THREE.VideoTexture(video), side: THREE.DoubleSide});
var material3 = new THREE.MeshPhongMaterial({
  map: img2,
	side: THREE.DoubleSide,
	//color: 0x383838,
	specular: 0xffffff,
	shininess: 0,
	//bumpMap: mapbump,
	//bumpScale: 0.2,
	reflectivity : 0,

});
var material4 = new THREE.MeshPhongMaterial({map: img1, side: THREE.DoubleSide});
var material5 = new THREE.MeshPhongMaterial({
	map: img6,
	side: THREE.DoubleSide,
	//color: 0x383838,
	specular: 0xffffff,
	shininess: 0,
	bumpMap: mapbump2,
	bumpScale: 2,
	reflectivity : 10,
	specular : 0x7e7e7e,
});
var material6 = new THREE.MeshPhongMaterial({color:0xffffff, side: THREE.DoubleSide});

var photos = new THREE.BoxGeometry(7,10,0.2);
var geometry2 = new THREE.PlaneGeometry(10,20,0);
var geometry3 = new THREE.PlaneGeometry(6,9,0);
var geometry4 = new THREE.BoxGeometry(7,9,0.2);


var meshPhotos = new THREE.Mesh(photos, material5);
var mesh2 = new THREE.Mesh( geometry2, material2 );
var mesh3 = new THREE.Mesh( geometry3, material4 );
var mesh4 = new THREE.Mesh( geometry4, material3);


		  meshPhotos.position.set( 0, 5, 20 );
			mesh2.position.set( 20, 8, 10);
			mesh3.position.set( -18, 9, 5);
			mesh4.position.set( 0, 7, 0);

      mesh2.rotation.set( 0, 30, 0);
			mesh3.rotation.set( 0, 30, 0);
			mesh4.rotation.set( 50, 28, 0);


			scene.add( meshPhotos );
			scene.add( mesh2 );
			scene.add( mesh3 );
			scene.add( mesh4 );


			// CUBE

			  var galerieMesh, galerieScene, galerieCamera;
        var galerie = new THREE.BoxGeometry(50,25,50);

			  var galerieMesh = new THREE.Mesh(galerie, materialPhotos);

				//backgroundMesh.material.depthTest = false;
				//backgroundMesh.material.depthWrite = false;

				galerieScene = new THREE.Scene();
				galerieCamera = new THREE.Camera();
				//backgroundScene.add(galerieCamera);
				//backgroundScene.add(galerieMesh);
        galerieMesh.position.y = 10 ;
			  scene.add( galerieMesh );


//GROUND

var ground = new THREE.PlaneGeometry(51,51,10);
var groundMirror = new THREE.Reflector( ground, {
clipBias:0.03,
textureWidth: 10 * window.devicePixelRatio,
textureHeight: 10 * window.devicePixelRatio,
color: 0x515151,
recursion: 1,
} );

groundMirror.position.y = 0;
groundMirror.rotation.x-= Math.PI/2;
scene.add( groundMirror );

//PLAFOND

var plafond = new THREE.PlaneGeometry(45,45,10,10);
var plafondMirror = new THREE.Reflector( plafond, {
clipBias:0.003,
textureWidth: 20 * window.devicePixelRatio,
textureHeight: 20 * window.devicePixelRatio,
color: 0x000000,
recursion: 6,
} );

plafondMirror.position.y = 23.5 ;
plafondMirror.rotation.x+= Math.PI/2;
scene.add( plafondMirror );





  requestAnimationFrame( animate );



// RENDER LOOP
	animate();

	function animate() {

		if(keyboard[87]){ //W key
			camera.rotation.y += Math.PI*0.003;
		}

		if(keyboard[88]){ //X key
			camera.rotation.y -= Math.PI*0.003;
		}

		if(keyboard[67]){ //UP
			camera.position.x += Math.PI*0.03;
		}

		if(keyboard[86]){ //DOWN
			camera.position.x -= Math.PI*0.03;
		}

		if(keyboard[66]){ //RIGHT
			camera.position.z += Math.PI*0.03;
		}

		if(keyboard[78]){ //LEFT
			camera.position.z -= Math.PI*0.03;
		}

    //camera.rotation.y += 0.002;


		mesh4.rotation.y += 0.002;

    //mesh.rotation.y += 0.002;
    renderer.autoClear = false;
		renderer.clear();
    renderer.render( galerieScene, galerieCamera );
    renderer.render( scene, camera );
		requestAnimationFrame( animate );

	}



	function keyDown (event){
		keyboard[event.keyCode]=true;
	}

	function keyUp(event){
	  keyboard[event.keyCode]=false;
	}

	window.addEventListener('keydown', keyDown);
	window.addEventListener('keyup', keyUp);


	  </script>
	</body>
</html>
